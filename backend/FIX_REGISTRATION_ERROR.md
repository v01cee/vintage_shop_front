# Исправление ошибки 500 при регистрации

## Проблема

При попытке зарегистрировать пользователя через `POST /api/v1/users/register` возвращается ошибка 500 "Ошибка базы данных".

## Возможные причины

1. **Невалидные данные**: В вашем примере `phone_or_email: "123"` не является валидным email или телефоном
2. **Проблема подключения к БД**: База данных может быть недоступна
3. **Проблема с хешированием пароля**: Хотя мы исправили bcrypt, может быть другая проблема

## Как проверить и исправить

### Шаг 1: Проверьте подключение к БД

```bash
cd backend
python check_setup.py
```

Или вручную:
```bash
python -c "from app.database import engine; engine.connect(); print('OK')"
```

### Шаг 2: Используйте валидные данные

Вместо:
```json
{
  "phone_or_email": "123",
  "password": "123123"
}
```

Используйте:
```json
{
  "phone_or_email": "test@example.com",
  "password": "test123456",
  "full_name": "Test User"
}
```

Или для телефона:
```json
{
  "phone_or_email": "+79991234567",
  "password": "test123456",
  "full_name": "Test User"
}
```

### Шаг 3: Проверьте логи сервера

Когда запускаете сервер с `uvicorn main:app --reload`, смотрите в консоль - там должны быть детали ошибки.

### Шаг 4: Проверьте валидацию

Валидация должна работать автоматически. Если вы отправляете `phone_or_email: "123"`, должна вернуться ошибка 400 "Неверный формат email или телефона", а не 500.

## Форматы данных

### Email
- ✅ `test@example.com`
- ✅ `user.name+tag@example.co.uk`
- ❌ `123`
- ❌ `test@`
- ❌ `@example.com`

### Телефон (формат E.164)
- ✅ `+79991234567`
- ✅ `79991234567`
- ✅ `+1234567890`
- ❌ `123`
- ❌ `8-999-123-45-67`
- ❌ `(999) 123-45-67`

### Пароль
- ✅ Минимум 6 символов
- ✅ Максимум 100 символов
- ❌ Меньше 6 символов

## Пример правильной регистрации

```json
{
  "phone_or_email": "test@example.com",
  "password": "test123456",
  "full_name": "Иван Иванов",
  "phone": "+79991234567",
  "address": "Москва, ул. Тестовая, д. 1"
}
```

## Если проблема сохраняется

1. Проверьте, что сервер запущен с правильным `.env` файлом
2. Проверьте логи в консоли сервера
3. Убедитесь, что миграции применены: `alembic upgrade head`
4. Проверьте, что таблица `users` существует в БД



